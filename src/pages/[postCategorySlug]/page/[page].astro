---
import { StrapiPostEndpoints } from '../../../lib/strapi';
import ArticleListing from '../../../components/blog/ArticleListing.astro';

export const prerender = false;

const { postCategorySlug, page: pageNumber } = Astro.params;

if (!postCategorySlug || !pageNumber) {
  return Astro.redirect('/404');
}

const pageAsNumber = parseInt(pageNumber);

if (isNaN(pageAsNumber)) {
  return Astro.redirect('/404');
}

const response = await StrapiPostEndpoints.getCategoryPosts(
  postCategorySlug,
  pageAsNumber
);

if (!response.data.length) {
  return Astro.redirect(`/${Astro.params.postCategorySlug}`, 302);
}
---

<ArticleListing postsResponse={response} />
